(()=>{"use strict";function t(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}function e(e,r){return fetch(e,r).then(t)}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function o(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach((function(e){var n,c,u,i;n=t,c=e,u=o[e],i=function(t,e){if("object"!=r(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(c),(c="symbol"==r(i)?i:String(i))in n?Object.defineProperty(n,c,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[c]=u})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var c="https://nomoreparties.co/v1/wff-cohort-9/",u={authorization:"ae10f372-4d40-4524-9b30-6d18148907a0","Content-Type":"application/json"};function i(t,e,r,n,o){var c=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),u=c.querySelector(".card__image"),i=c.querySelector(".card__delete-button"),a=c.querySelector(".card__like-button"),l=c.querySelector(".card__like_count");return t.likes.some((function(t,e,r){return t._id===o}))&&a.classList.add("card__like-button_is-active"),l.textContent=t.likes.length,c.querySelector(".card__title").textContent=t.name,u.src=t.link,u.alt=t.name,u.addEventListener("click",(function(t){n(t)})),t.owner._id===o?i.addEventListener("click",(function(){e(t._id,c)})):i.remove(),c.querySelector(".card__like-button").addEventListener("click",(function(e){r(e.target,t._id,l)})),c}function a(t,r){(function(t){return e("".concat(c,"cards/").concat(t),{method:"DELETE",headers:o({},u)})})(t).then((function(t){r.remove()})).catch((function(t){return console.log(t)}))}function l(t,r,n){t.classList.contains("card__like-button_is-active")?function(t){return e("".concat(c,"cards/likes/").concat(t),{method:"DELETE",headers:o({},u)})}(r).then((function(e){t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(t){return console.log(t)})):function(t){return e("".concat(c,"cards/likes/").concat(t),{method:"PUT",headers:o({},u)})}(r).then((function(e){t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(t){return console.log(t)}))}function p(t){return document.addEventListener("keydown",_),t.classList.add("popup_is-opened"),t.addEventListener("click",d),t}function s(t){document.removeEventListener("keydown",_),t.classList.remove("popup_is-opened"),t.removeEventListener("click",d)}function d(t){(t.target.classList.contains("popup__close")||t.target===t.currentTarget)&&s(t.currentTarget)}function _(t){"Escape"===t.key&&s(document.querySelector(".popup_is-opened"))}var f=function(t,e,r){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(r.inactiveButtonClass)):(e.disabled=!0,e.classList.add(r.inactiveButtonClass))},m=function(t,e,r){e.validity.valid?function(t,e,r){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(t,e,r):(e.validity.paternMismatch&&e.setCustomValidity(e.dataset.errorMessage),function(t,e,r,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(t,e,e.validationMessage,r))};function y(t,e){var r=t.querySelectorAll(e.inputSelector),n=t.querySelector(e.buttonSelector),o=Array.from(r);r.forEach((function(r){var n=t.querySelector(".".concat(r.id,"-error"));n.classList.remove(e.errorClass),n.textContent="",r.classList.remove(e.inputErrorClass)})),f(o,n,e)}var v=document.querySelector(".places__list"),b=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),g=document.querySelector(".popup__form[name = new-place]"),h=document.querySelector(".popup__form[name = edit-profile]"),q=h.querySelector(".popup__input_type_name"),C=h.querySelector(".popup__input_type_description"),E=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),k=document.querySelector(".popup__form[name = new-place]"),O=document.querySelector(".popup_type_edit"),x=document.querySelector(".popup_type_new-card"),w=document.querySelector(".popup_type_image"),j=document.querySelector(".profile__image"),P=document.querySelector(".popup_type_avatar"),A=document.querySelector(".popup__form[name = edit-avatar]"),T=document.querySelector(".popup__input_type_avatar"),D=document.querySelector(".popup__caption"),B=document.querySelector(".popup_type_avatar"),N=document.querySelector(".popup__input_type_avatar"),J=document.querySelector(".popup_type_edit"),M=document.querySelector(".popup_type_new-card"),H=document.querySelector(".popup__input_type_card-name"),I=document.querySelector(".popup__input_type_url");function V(t){var e=t.target.getAttribute("src"),r=t.target.getAttribute("alt");D.textContent=r;var n=p(w).querySelector(".popup__image");n.setAttribute("src",e),n.setAttribute("alt",r)}Promise.all([e("".concat(c,"users/me"),{method:"GET",headers:o({},u),body:JSON.stringify()}),e(c+"cards",{headers:o({},u)})]).then((function(t){return t[1].forEach((function(e){var r=t[0];j.style.backgroundImage="url(".concat(r.avatar,")"),E.textContent=r.name,L.textContent=r.about,q.value=r.name,C.value=r.about,T.value=r.avatar;var n=i(e,a,l,V,r._id);v.append(n)}))})).then((function(){return t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},void Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);r.forEach((function(o){o.addEventListener("input",(function(){o.setCustomValidity(""),m(t,o,e),f(r,n,e)}))})),f(r,n,e)}(e,t)}));var t})),j.addEventListener("click",(function(){p(P)})),b.addEventListener("click",(function(){q.value=E.textContent,C.value=L.textContent,y(h,{buttonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputSelector:".popup__input",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}),p(O)})),S.addEventListener("click",(function(){y(g,{inputSelector:".popup__input",buttonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"}),p(x)})),h.addEventListener("submit",(function(t){t.preventDefault();var r,n=t.target.querySelector(".popup__button");n.textContent="идет загрузка...",n.disabled=!0,(r={name:q.value,about:C.value},e("".concat(c,"users/me"),{method:"PATCH",headers:o({},u),body:JSON.stringify(r)})).then((function(t){E.textContent=t.name,L.textContent=t.about,s(J)})).catch((function(t){return console.log(t)})).finally((function(){n.textContent="Сохранить",n.disabled=!1}))})),k.addEventListener("submit",(function(t){t.preventDefault();var r,n=t.target.querySelector(".popup__button");n.textContent="идет загрузка...",n.disabled=!0,(r={name:H.value,link:I.value},e("".concat(c,"cards"),{method:"POST",headers:o({},u),body:JSON.stringify(r)})).then((function(e){var r=i(e,a,l,V,e.owner._id);v.prepend(r),s(M),t.target.reset()})).catch((function(t){return console.log(t)})).finally((function(){n.textContent="Сохранить",n.disabled=!1}))})),A.addEventListener("submit",(function(t){t.preventDefault();var r=t.target.querySelector(".popup__button");r.textContent="идет загрузка...",r.disabled=!0,function(t){return e("".concat(c,"users/me/avatar"),{method:"PATCH",headers:o({},u),body:JSON.stringify(t)})}({avatar:N.value}).then((function(t){j.style.backgroundImage="url(".concat(t.avatar,")"),s(B)})).catch((function(t){return console.log(t)})).finally((function(){r.textContent="Сохранить",r.disabled=!1}))}))})();